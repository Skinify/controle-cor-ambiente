<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
	<script src="webOSTVjs-1.2.0/webOSTV.js" charset="utf-8"></script>
	<script src="webOSTVjs-1.2.0/webOSTV-dev.js" charset="utf-8"></script>
	<script type="text/javascript">
	   //sample code for calling LS2 API
       var lunaReq= webOS.service.request("luna://com.palm.systemservice",
        {
            method:"clock/getTime",
            parameters:{},
            onSuccess: function (args) {
            },
            onFailure: function (args) {
            }
        });
	</script>
</head>
<body>
	<main>
		<div id="background">
			<div id="interface">
				<h1 id="title">CONTROLE DE COR AMBIENTE</h1>
				<div>
					<button class="primary-button" onclick="toggleOptions()">
						Temas
					</button>
					<button class="primary-button" onclick="abrirCriacao()">
						Criar tema
					</button>
				</div>
			</div>
		</div>
		<div id="options">
			<div class="titulo-container">
				<h2>Temas</h2>
				<button class="container-button botao-fechar" onclick="toggleOptions()">X</button>
			</div>
			<div class="row">
				<button class="direction-control-button container-button"><</button>
				<div id="temas">
					<!--<div class="tema selecionado"></div>
					<div class="tema"></div>
					<div class="tema"></div>
					<div class="tema"></div>-->
				</div>
				<button class="direction-control-button container-button">></button>
			</div>
		</div>
		<div id="criacao">
			<div class="titulo-container">
				<h2>Criação de temas</h2>
				<button class="container-button botao-fechar" onclick="abrirCriacao()">X</button>
			</div>
		</div>
	</main>
	<script>
		const background = document.querySelector("div#background")
		const interface = document.querySelector("div#interface")
		const options = document.querySelector("div#options")
		const criacao = document.querySelector("div#criacao")

		const optionsHeight = options.offsetHeight;
		const criacaoWidth = criacao.offsetWidth;

		const gradienteInicial = "linear-gradient(50deg, #ec4343, #3131f1)"
		const temas = document.querySelector("div#temas");

		background.style.backgroundImage = gradienteInicial
		var temaAtual = 0;

		var todosTemas = [{
			id:0,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue","yellow"]
		},
		{
			id:1,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue"]
		}]

		var opcaoAberta = false, criacaoAberta = false;

		function toggleOptions(){
			if(opcaoAberta){
				options.style.bottom = `-${optionsHeight}px`
				background.style.filter = "brightness(1) blur(0)"
				background.style.pointerEvents = "all";
				opcaoAberta = false;
			}else{
				options.style.bottom = `0px`;
				background.style.filter = "brightness(0.8) blur(0.6px)"
				background.style.pointerEvents = "none";
				opcaoAberta = true;
			}
		}

		function abrirCriacao(){
			if(criacaoAberta){
				criacao.style.right = `-${criacaoWidth}px`
				background.style.filter = "brightness(1) blur(0)"
				background.style.pointerEvents = "all";
				criacaoAberta = false;
			}else{
				criacao.style.right = `0px`;
				background.style.filter = "brightness(0.8) blur(0.6px)"
				background.style.pointerEvents = "none";
				criacaoAberta = true;
			}
		}

		function stopIdle(){
			interface.style.filter = "opacity(1)";
			idleCount = 0;
			idle = false;
		}

		function startIdle(){
			interface.style.filter = "opacity(0)";
			idle = true;
		}

		var idleCount = 0;
		var idle = false;
		const idleTimer = setInterval(function(){
			if(!idle){
				idleCount++;
				if(idleCount > 15){
					startIdle();
				}
			}
		},1000)

		document.body.addEventListener("mousemove", stopIdle);


		function carregarTemas(){
			temas.innerHTML = "";
			todosTemas.forEach(function (tema) {
				let gradiente = gerarGradiente(tema);
				temas.innerHTML += `<div class="tema" tabindex='${tema.id}' id='${tema.id}' style='${gradiente}' />`
			})
			atribuirEvento()
		} 

		function gerarGradiente(e){
			//repeating-radial-gradient(black, transparent 100px)
			//repeating-linear-gradient(45deg, black, transparent 100px)
			//radial-gradient(black, transparent)
			//linear-gradient(45deg, black, transparent)
			let cores = "";
			e.cores.forEach(function(cor, i){
				if(i == (e.cores.length - 1)){
					cores += `${cor}`
				}else{
					cores += `${cor},`
				}
			})
			return `background-image:linear-gradient(${e.angulo}deg, ${cores})`
		}

		function atribuirTema(e, temaDefinido){
			let todosTemasDefinidos = document.querySelectorAll("div.tema"); 
			todosTemasDefinidos.forEach(function(tema){
				if(tema == e.target){
					tema.classList.add("selecionado")
				}else{
					tema.classList.remove("selecionado")
				}
			})
			background.style.backgroundImage = e.target.style.backgroundImage
		}

		function atribuirEvento(){
			let todosTemasDefinidos = document.querySelectorAll("div.tema");
			todosTemasDefinidos.forEach(function(temaDefinido){
				temaDefinido.addEventListener("click", function(e){atribuirTema(e,temaDefinido)})
			})
		}

		var teste = 0;

		function saturar(){
			teste = numeroEntre(-1, 1)
			//filter :saturete()
			//console.log(teste)
			//console.log(background.style)
		}

		setInterval(function(){
			saturar()
		}, 100)

		function numeroEntre(x, y){
			return Math.floor(Math.random() * y) + x; 
		}

		carregarTemas();

	</script>
</body>
</html>
