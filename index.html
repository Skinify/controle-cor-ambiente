<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
	<script src="webOSTVjs-1.2.0/webOSTV.js" charset="utf-8"></script>
	<script src="webOSTVjs-1.2.0/webOSTV-dev.js" charset="utf-8"></script>
	<script type="text/javascript">
	   //sample code for calling LS2 API
       var lunaReq= webOS.service.request("luna://com.palm.systemservice",
        {
            method:"clock/getTime",
            parameters:{},
            onSuccess: function (args) {
            },
            onFailure: function (args) {
            }
        });
	</script>
</head>
<body>
	<main>
		<div id="background">
			<div id="interface">
				<h1 id="title">CONTROLE DE COR AMBIENTE</h1>
				<div>
					<button class="primary-button" onclick="toggleOptions()">
						Temas
					</button>
					<button class="primary-button" onclick="abrirCriacao()">
						Criar tema
					</button>
				</div>
			</div>
		</div>
		<div id="options">
			<div class="titulo-container">
				<h2>Temas</h2>
				<button class="container-button botao-fechar" onclick="toggleOptions()">X</button>
			</div>
			<div class="row">
				<button class="direction-control-button container-button"><</button>
				<div id="temas">
					<!--<div class="tema selecionado"></div>
					<div class="tema"></div>
					<div class="tema"></div>
					<div class="tema"></div>-->
				</div>
				<button class="direction-control-button container-button">></button>
			</div>
		</div>
		<div id="criacao">
			<div class="titulo-container">
				<h2>Criação de temas</h2>
				<button class="container-button botao-fechar" onclick="abrirCriacao()">X</button>
			</div>
			<div  class="grupo-filtro cores">
				<h2>Cores</h2>
				<div class="row" style="justify-content:flex-start;align-items: center;">
					<div style="display: flex; flex:1">
						<input type="text" class="cor-input">
					</div>
					<div class="row" style="flex:0">
						<button type="button" class="container-button">+</button>
						<button type="button" class="container-button">-</button>
					</div>
					
				</div>
			</div>
			
			<div class="grupo-filtro">
				<div class="row" style="align-items: center;justify-content: space-between;">
					<h2>Luminosidade</h2>
					<span id="valor-luminosidade">1.0</span>
				</div>
				<input type="range"  min="0.4" max="2" step="0.02" class="slider" oninput="alterarValorSlider(this)">
			</div>
			<div class="grupo-filtro">
				<h2>Pré visualizar</h2>
				<div class="pre-visualizar">
					
				</div>
			</div>
			<div style="display: flex;padding:20px 30px; justify-content: space-between;">
				<button class="primary-button" style="margin:0">limpar</button>
				<button class="primary-button" style="margin:0">confirmar</button>
			</div>
		</div>
	</main>
	<script>


		function alterarValorSlider(e){
			e.parentElement.children[0].children[1].innerHTML = e.value
		}


		const background = document.querySelector("div#background")
		const interface = document.querySelector("div#interface")
		const options = document.querySelector("div#options")
		const criacao = document.querySelector("div#criacao")

		const optionsHeight = options.offsetHeight;
		const criacaoWidth = criacao.offsetWidth;

		const gradienteInicial = "linear-gradient(50deg, #ec4343, #3131f1)"
		const temas = document.querySelector("div#temas");

		background.style.backgroundImage = gradienteInicial
		var temaAtual = 0;
		var filtrosTema = {
			brightness: 1,
			blur:0,
			saturate:1,
			opacity: 1
		}

		var todosTemas = [{
			id:0,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue","yellow"]
		},
		{
			id:1,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue"]
		}]

		var opcaoAberta = false, criacaoAberta = false;

		function toggleOptions(){
			if(opcaoAberta){
				options.style.bottom = `-${optionsHeight}px`
				background.style.filter = gerarFiltros(0, 1, 1, 1, true)
				background.style.pointerEvents = "all";
				opcaoAberta = false;
			}else{
				options.style.bottom = `0px`;
				console.log(gerarFiltros())
				background.style.filter = gerarFiltros(0.6, 0.8, 1, 1, true)
				background.style.pointerEvents = "none";
				opcaoAberta = true;
			}
		}

		function abrirCriacao(){
			if(criacaoAberta){
				criacao.style.right = `-${criacaoWidth}px`
				background.style.filter = gerarFiltros(0,1,1,1, true)
				background.style.pointerEvents = "all";
				criacaoAberta = false;
			}else{
				criacao.style.right = `0px`;
				background.style.filter = gerarFiltros(0.6,0.8,1,1, true)
				background.style.pointerEvents = "none";
				criacaoAberta = true;
			}
		}

		function stopIdle(){
			interface.style.filter = gerarFiltros(0,1,1,1);
			idleCount = 0;
			idle = false;
		}

		function startIdle(){
			interface.style.filter = gerarFiltros(0,1,1,0);
			idle = true;
		}

		var idleCount = 0;
		var idle = false;
		const idleTimer = setInterval(function(){
			if(!idle){
				idleCount++;
				if(idleCount > 2){
					startIdle();
				}
			}
		},1000)

		window.addEventListener("mousemove", stopIdle);


		function carregarTemas(){
			temas.innerHTML = "";
			todosTemas.forEach(function (tema) {
				let gradiente = gerarGradiente(tema);
				temas.innerHTML += `<div class="tema" tabindex='${tema.id}' id='${tema.id}' style='${gradiente}' />`
			})
			atribuirEvento()
		} 

		function gerarGradiente(e){
			//repeating-radial-gradient(black, transparent 100px)
			//repeating-linear-gradient(45deg, black, transparent 100px)
			//radial-gradient(black, transparent)
			//linear-gradient(45deg, black, transparent)
			let cores = "";
			e.cores.forEach(function(cor, i){
				if(i == (e.cores.length - 1)){
					cores += `${cor}`
				}else{
					cores += `${cor},`
				}
			})
			return `background-image:linear-gradient(${e.angulo}deg, ${cores})`
		}

		function atribuirTema(e, temaDefinido){
			let todosTemasDefinidos = document.querySelectorAll("div.tema"); 
			todosTemasDefinidos.forEach(function(tema){
				if(tema == e.target){
					tema.classList.add("selecionado")
				}else{
					tema.classList.remove("selecionado")
				}
			})
			background.style.backgroundImage = e.target.style.backgroundImage
		}

		function atribuirEvento(){
			let todosTemasDefinidos = document.querySelectorAll("div.tema");
			todosTemasDefinidos.forEach(function(temaDefinido){
				temaDefinido.addEventListener("click", function(e){atribuirTema(e,temaDefinido)})
			})
		}

		var teste = 0;

		function saturar(){
			background.style.filter = gerarFiltros(filtrosTema.blur, filtrosTema.brightness, numeroEntre(1, 1.10), filtrosTema.opacity)
		}

		function gerarFiltros(blur = filtrosTema.blur, brightness = filtrosTema.brightness, saturate = filtrosTema.saturate, opacity = filtrosTema.opacity, atulizar = false){
			if(atulizar){
				filtrosTema.blur = blur;
				filtrosTema.brightness = brightness;
				filtrosTema.saturate = saturate;
				filtrosTema.opacity = opacity;
			}
			return `blur(${blur}px) brightness(${brightness}) saturate(${saturate}) opacity(${opacity})`
		}

		setInterval(function(){
			saturar()
		}, 1000)

		function numeroEntre(x, y){
			return (Math.random() * (y - x) + x).toFixed(2)
		}

		carregarTemas();

	</script>
</body>
</html>
