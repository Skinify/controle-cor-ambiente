<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="styles.css"/>
	<script src="webOSTVjs-1.2.0/webOSTV.js" charset="utf-8"></script>
	<script src="webOSTVjs-1.2.0/webOSTV-dev.js" charset="utf-8"></script>
	<script type="text/javascript">
	   //sample code for calling LS2 API
       var lunaReq= webOS.service.request("luna://com.palm.systemservice",
        {
            method:"clock/getTime",
            parameters:{},
            onSuccess: function (args) {
            },
            onFailure: function (args) {
            }
        });
	</script>
</head>
<body>
	<main>
		<div id="background">
			<div id="interface">
				<h1 id="title">CONTROLE DE COR AMBIENTE</h1>
				<div>
					<button class="primary-button" onclick="toggleOptions()">
						Temas
					</button>
					<button class="primary-button">
						Criar tema
					</button>
				</div>
			</div>
		</div>
		<div id="options">
			<button id="close-button" class="options-button" onclick="toggleOptions()">X</button>
			<div class="row">
				<button class="direction-control-button options-button"><</button>
				<div id="temas">
					<!--<div class="tema selecionado"></div>
					<div class="tema"></div>
					<div class="tema"></div>
					<div class="tema"></div>-->
				</div>
				<button class="direction-control-button options-button">></button>
			</div>
		</div>
	</main>
	<script>
		const background = document.querySelector("div#background")
		const interface = document.querySelector("div#interface")
		const options = document.querySelector("div#options")
		const optionsHeight = options.offsetHeight;
		const gradienteInicial = "linear-gradient(50deg, #ec4343, #3131f1)"
		const temas = document.querySelector("div#temas");

		background.style.backgroundImage = gradienteInicial
		var temaAtual = 0;

		var todosTemas = [{
			id:0,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue","yellow"]
		},
		{
			id:1,
			angulo: 90,
			tipo: "linear",
			cores:["red","blue"]
		}]

		var openedOptions = false;

		function toggleOptions(){
			if(openedOptions){
				options.style.bottom = `-${optionsHeight}px`
				background.style.filter = "brightness(1) blur(0)"
				background.style.pointerEvents = "all";
				openedOptions = false;
			}else{
				options.style.bottom = `0px`;
				background.style.filter = "brightness(0.9) blur(0.2px)"
				background.style.pointerEvents = "none";
				openedOptions = true;
			}
		}

		function stopIdle(){
			interface.style.filter = "opacity(1)";
			idleCount = 0;
			idle = false;
		}

		function startIdle(){
			interface.style.filter = "opacity(0)";
			idle = true;
		}

		var idleCount = 0;
		var idle = false;
		const idleTimer = setInterval(function(){
			if(!idle){
				idleCount++;
				if(idleCount > 999){
					startIdle();
				}
			}
		},1000)

		document.body.addEventListener("mousemove", stopIdle);


		function carregarTemas(){
			temas.innerHTML = "";
			todosTemas.forEach(function (tema) {
				let gradiente = gerarGradiente(tema);
				temas.innerHTML += `<div class="tema" tabindex='${tema.id}' id='${tema.id}' style='${gradiente}' />`
			})
			atribuirEvento()
		} 

		function gerarGradiente(e){
			//repeating-radial-gradient(black, transparent 100px)
			//repeating-linear-gradient(45deg, black, transparent 100px)
			//radial-gradient(black, transparent)
			//linear-gradient(45deg, black, transparent)
			let cores = "";
			e.cores.forEach(function(cor, i){
				if(i == (e.cores.length - 1)){
					cores += `${cor}`
				}else{
					cores += `${cor},`
				}
			})
			return `background-image:linear-gradient(${e.angulo}deg, ${cores})`
		}

		function atribuirTema(e, temaDefinido){
			let todosTemasDefinidos = document.querySelectorAll("div.tema"); 
			todosTemasDefinidos.forEach(function(tema){
				if(tema == e.target){
					tema.classList.add("selecionado")
				}else{
					tema.classList.remove("selecionado")
				}
			})
			background.style.backgroundImage = e.target.style.backgroundImage
		}

		function atribuirEvento(){
			let todosTemasDefinidos = document.querySelectorAll("div.tema");
			todosTemasDefinidos.forEach(function(temaDefinido){
				temaDefinido.addEventListener("click", function(e){atribuirTema(e,temaDefinido)})
			})
		}

		carregarTemas();

	</script>
</body>
</html>
